<!DOCTYPE html>
<html>
  <head><meta charset="utf-8">
  </head>
 <script src="https://d3js.org/d3.v4.js"></script>
 <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>
 <body>
  <style>
    .d3-tip {
      line-height: 1;
      font-weight: bold;
      padding: 12px;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      border-radius: 2px;
    }

    /* Creates a small triangle extender for the tooltip */
    .d3-tip:after {
      box-sizing: border-box;
      display: inline;
      font-size: 10px;
      width: 100%;
      line-height: 1;
      color: rgba(0, 0, 0, 0.8);
      content: "\25BC";
      position: absolute;
      text-align: center;
    }

    /* Style northward tooltips differently */
    .d3-tip.n:after {
      margin: -1px 0 0 0;
      top: 100%;
      left: 0;
    }
  </style>
  <div id="gasolineDataviz">
   <select id="gasolineSelect"></select>
   <br>
   <svg id="gasoline"></svg>
  </div>
  <div id="dieselDataviz">
    <select id="dieselSelect"></select>
    <br>
    <svg id="diesel"></svg>
   </div>
  <script>
    var margin = {top: 10, right: 60, bottom: 100, left: 30},
        width = screen.width - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

    // select the svg object to the body of the page
    var gasolineSvg = d3.select("#gasoline")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");
    var gasolineTip = d3.tip()
      .attr('class', 'd3-tip')
      .offset([-10, 0])
      .html(function(d) {
        return "<strong>Make:</strong> <span style='color:red'>" + (d['Make']).split("_")[0] + "</span><br><strong>Engine Cylinders:</strong> <span style='color:red'>" + d['EngineCylinders'] + "</span><br><strong>"+selectedGroup+":</strong> <span style='color:red'>" + d[selectedGroup] + "</span>";
      })
    gasolineSvg.call(gasolineTip);
    // List of groups (here I have one group per column)
    var allGroup = ["AverageHighwayMPG","AverageCityMPG"]

    // add the options to the button
    d3.select("#gasolineSelect")
      .selectAll('myOptions')
      .data(allGroup)
      .enter()
      .append('option')
      .text(function (d) { return d; }) // text showed in the menu
      .attr("value", function (d) { return d; }) // corresponding value returned by the button

    // A color scale: one color for each group
    var myColor = d3.scaleOrdinal()
      .domain(['2','3','4','6','8','10','12'])
      .range(d3.schemeSet2);

    var x = d3.scaleBand()
        .range([0, width])
        .padding(0.3);
    var xAxis = gasolineSvg.append("g")
        .attr("transform", "translate(0," + height + ")")

    // Initialize the Y axis
    var y = d3.scaleLinear()
        .range([height, 0]);
    var yAxis = gasolineSvg.append("g")
        .attr("class", "myYaxis")

    // A function that update the chart
    function updateGasoline(selectedGroup) {
      
      // Parse the Data
      d3.csv("./data/cars2017_Gasoline.csv", function(data) {

        // X axis
        x.domain(data.map(function(d) { return d.Make; }))
        xAxis.transition().duration(1000).call(d3.axisBottom(x)).selectAll("text")
            .attr("transform", "translate(-15,10)rotate(-45)")
            .style("text-anchor", "end");

        // Add Y axis
        y.domain([0, d3.max(data, function(d) { return +d[selectedGroup] }) ]);
        yAxis.transition().duration(1000).call(d3.axisLeft(y));

        
        
        // variable u: map data to existing bars
        var u3 = gasolineSvg.selectAll("rect")
            .data(data)
            .on('mouseover', gasolineTip.show)
            .on('mouseout', gasolineTip.hide);

        // update bars
        u3
            .enter()
            .append("rect")
            .merge(u3)
            .transition()
            .duration(1000)
            .attr("x", function(d) { return x(d['Make']); })
            .attr("y", function(d) { return y(d[selectedGroup]); })
            .attr("width", x.bandwidth())
            .attr("height", function(d) { return height - y(d[selectedGroup]); })
            .attr('fill',function(d){ return myColor(d["EngineCylinders"]); })
      })
    
    }

    updateGasoline('AverageHighwayMPG');
    updateGasoline('AverageHighwayMPG');

    // When the button is changed, run the updateChart function
    d3.select("#gasolineSelect").on("change", function(d) {
        // recover the option that has been chosen
        var selectedOption = d3.select(this).property("value")
        // run the updateChart function with this selected option
        updateGasoline(selectedOption)
    })

  </script>
 </body>
</html>
